import{r as n,u as U,j as a,E as A}from"./index-B7VZ3xPM.js";function B(i){n.useEffect(()=>(i?document.body.style.overflow="hidden":document.body.style.overflow="",()=>{document.body.style.overflow=""}),[i])}function V(){const i=e=>`/canteen/${e||"default.jpg"}`,[$,w]=n.useState([{category:"South Indian",items:[{id:1,name:"Idli Sambar",price:40,img:"idli_sambar.jpg"},{id:2,name:"Masala Dosa",price:60,img:"masala_dosa.jpg"},{id:3,name:"Plain Dosa",price:50,img:"plain_dosa.jpeg"}]},{category:"Snacks",items:[{id:4,name:"Samosa",price:15,img:"samosa.jpeg"},{id:5,name:"Veg Puff",price:20,img:"veg_puff.jpg"},{id:6,name:"Paneer Roll",price:45,img:"paneer_role.jpg"}]},{category:"Rice & Biryani",items:[{id:7,name:"Veg Fried Rice",price:80,img:"veg_fried_rice.jpeg"},{id:8,name:"Veg Biryani",price:90,img:"veg_biryani.jpg"}]},{category:"Beverages",items:[{id:9,name:"Tea",price:15,img:"tea.webp"},{id:10,name:"Coffee",price:20,img:"coffee.jpg"}]}]);n.useEffect(()=>{fetch("/canteen/items.json").then(e=>e.json()).then(e=>{w(t=>[...t,...e])}).catch(()=>{})},[]);const[y,N]=n.useState(!1),[v,p]=n.useState(!1),[b,S]=n.useState(!1),[l,o]=n.useState([]),[x,D]=n.useState(""),[E,C]=n.useState([]),[I,P]=n.useState({text:"",open:!1}),k=n.useRef(new Map),h=n.useRef(null);B(y||v||b),n.useEffect(()=>{const e=JSON.parse(localStorage.getItem("cart"))||[];o(e)},[]),n.useEffect(()=>{localStorage.setItem("cart",JSON.stringify(l))},[l]),n.useEffect(()=>{const e=JSON.parse(localStorage.getItem("receipts"))||[];C(e)},[]);const F=e=>{const t=[e,...E];C(t),localStorage.setItem("receipts",JSON.stringify(t))},O=U(),q=e=>{const t=new A;t.text("Cafeteria Receipt",10,10),t.text(`Token: ${e.token}`,10,20),t.text(`Paid At: ${e.paidAt}`,10,30),t.text(`UPI ID: ${e.upiId}`,10,40);let s=55;e.items.forEach(c=>{t.text(`${c.name} x ${c.qty} = â‚¹${c.price*c.qty}`,10,s),s+=10}),t.text(`Item Total: â‚¹${e.itemTotal}`,10,s+10),t.text(`Service Fee: â‚¹${e.serviceFee}`,10,s+20),t.text(`GST: â‚¹${e.gst}`,10,s+30),t.text(`Total Paid: â‚¹${e.toPay}`,10,s+40),t.save(`Receipt-${e.token}.pdf`)},_=(e,t=1)=>{const s=k.current.get(e.id)||0,c=Date.now();c-s<400||(k.current.set(e.id,c),o(f=>{const u=f.findIndex(r=>r.id===e.id);if(u>=0){const r=f.slice();return r[u]={...r[u],qty:(r[u].qty||0)+t},r}return[...f,{...e,qty:t}]}),P({text:`${e.name} added to cart`,open:!0}),h.current&&clearTimeout(h.current),h.current=setTimeout(()=>P({text:"",open:!1}),1400))},T=e=>{o(t=>t.filter(s=>s.id!==e))},R=(e,t)=>{if(t<=0)return T(e);o(s=>s.map(c=>c.id===e?{...c,qty:t}:c))},d=l.reduce((e,t)=>e+t.price*t.qty,0),m=d*.05,g=(d+m)*.05,j=d+m+g,M=()=>{if(!x){alert("Please enter UPI ID");return}const e={token:Math.floor(Math.random()*1e5),items:l,itemTotal:d,serviceFee:m,gst:g,toPay:j,upiId:x,paidAt:new Date().toLocaleString()};F(e),q(e),p(!1),o([]),localStorage.removeItem("cart"),setTimeout(()=>{S(!0)},500)};return a.jsxs("div",{className:"canteen-page",children:[a.jsxs("header",{className:"header",children:[a.jsx("h1",{children:"Cafeteria"}),a.jsxs("div",{className:"header-actions",children:[a.jsx("button",{className:"home-btn",onClick:()=>O("/"),children:"ðŸ  Home"}),a.jsxs("button",{className:"cart-btn",onClick:()=>N(!0),children:["ðŸ›’ Cart (",l.length,")"]})]})]}),a.jsx("main",{className:"menu",children:$.map(e=>a.jsxs("div",{className:"menu-section",children:[a.jsx("h2",{children:e.category}),a.jsx("div",{className:"menu-grid",children:e.items.map(t=>a.jsxs("div",{className:"menu-item-card",children:[a.jsx("img",{src:i(t.img),loading:"lazy",alt:t.name,className:"item-img",onError:s=>{s.target.dataset.fallback||(s.target.dataset.fallback="1",s.target.src=i("default.jpg"))}}),a.jsxs("div",{className:"item-info",children:[a.jsx("span",{className:"item-name",children:t.name}),a.jsxs("span",{className:"item-price",children:["â‚¹",t.price]})]}),a.jsx("button",{className:"add-btn",onClick:()=>_(t),children:"Add"})]},t.id))})]},e.category))}),y&&a.jsx("div",{className:"modal-overlay",children:a.jsxs("div",{className:"modal",children:[a.jsx("h2",{children:"ðŸ›’ Your Cart"}),l.length===0?a.jsx("p",{className:"cart-empty",children:"Cart is empty"}):a.jsx("ul",{className:"cart-list",children:l.map(e=>a.jsxs("li",{className:"cart-item",children:[a.jsxs("a",{href:"#",onClick:t=>t.preventDefault(),children:[e.name," x ",e.qty," = â‚¹",e.price*e.qty]}),a.jsxs("div",{className:"cart-controls",children:[a.jsx("button",{className:"qty-small",onClick:()=>R(e.id,e.qty-1),children:"-"}),a.jsx("button",{className:"qty-small",onClick:()=>R(e.id,e.qty+1),children:"+"}),a.jsx("button",{className:"remove-small",onClick:()=>T(e.id),children:"x"})]})]},e.id))}),a.jsxs("div",{className:"totals",children:["Item Total: ",a.jsxs("span",{style:{color:"#43cea2"},children:["â‚¹",d]})]}),a.jsxs("div",{className:"totals",children:["Service Fee: ",a.jsxs("span",{style:{color:"#43cea2"},children:["â‚¹",m.toFixed(2)]})]}),a.jsxs("div",{className:"totals",children:["GST: ",a.jsxs("span",{style:{color:"#43cea2"},children:["â‚¹",g.toFixed(2)]})]}),a.jsxs("div",{className:"total-amount",children:["Total: ",a.jsxs("span",{style:{color:"#2563eb"},children:["â‚¹",j.toFixed(2)]})]}),a.jsxs("div",{className:"actions-row",children:[a.jsxs("button",{className:"primary-action",onClick:()=>l.length>0&&p(!0),disabled:l.length===0,children:[a.jsx("span",{style:{marginRight:8},children:"ðŸ’³"})," Proceed to Pay"]}),a.jsx("button",{className:"secondary-action",onClick:()=>N(!1),children:"Close"})]})]})}),v&&a.jsx("div",{className:"modal-overlay",children:a.jsxs("div",{className:"modal",children:[a.jsx("h2",{children:"Payment"}),a.jsxs("p",{children:["Total to Pay: â‚¹",j.toFixed(2)]}),a.jsx("input",{type:"text",placeholder:"Enter UPI ID",value:x,onChange:e=>D(e.target.value)}),a.jsx("button",{className:"pay-btn",onClick:M,children:"âœ… Pay Now"}),a.jsx("button",{className:"close-btn",onClick:()=>p(!1),children:"Cancel"})]})}),b&&a.jsx("div",{className:"modal-overlay",children:a.jsxs("div",{className:"modal",children:[a.jsx("h2",{children:"ðŸŽ‰ Payment Successful!"}),a.jsx("p",{children:"Your order has been placed."}),a.jsx("button",{className:"close-btn",onClick:()=>S(!1),children:"Close"})]})}),I.open&&a.jsx("div",{className:"canteen-toast",children:I.text})]})}export{V as default};
